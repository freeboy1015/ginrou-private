#include <stdio.h>#include <stdlib.h>#include "ppm.h"// PPM 画像の入力unsigned char *readPPM(char *fname, int *x, int *y) {  FILE *fp;  char buf[1000];  unsigned char *image;  fp = fopen(fname, "rb");  if(fp == NULL) {    printf("file %s can not be opened.\n", fname);    exit(-1);  }  do {    fgets(buf, 1000, fp);  /* P6 */  } while(buf[0] == '#');  do {    fgets(buf, 1000, fp);  /* xsize, ysize */  } while(buf[0] == '#');	if (sscanf(buf, "%d %d", x, y) == 1) {		do {			fgets(buf, 1000, fp);  /* ysize */		} while(buf[0] == '#');		sscanf(buf, "%d", y);	}	  do {    fgets(buf, 1000, fp);  /* max value */  } while(buf[0] == '#');    image = (unsigned char *)malloc(*x * *y * 3);  fread(image, *x * *y, 3, fp);  fclose(fp);  return image;}// PPM 画像の出力void writePPM(char *fname, unsigned char *buf, int x, int y) {  FILE *fp;  fp = fopen(fname, "wb");  if(fp == NULL) {    printf("file %s can not be created.\n", fname);    exit(-1);  }  fprintf(fp, "P6\n%d %d\n255\n", x, y);  fwrite(buf, x * y, 3, fp);  fclose(fp);}// PGM 画像の入力unsigned char *readPGM(char *fname, int *x, int *y) {  FILE *fp;  char buf[1000];  unsigned char *image;  fp = fopen(fname, "rb");  if(fp == NULL) {    printf("file %s can not be opened.\n", fname);    exit(-1);  }  do {    fgets(buf, 1000, fp);  /* P5 */  } while(buf[0] == '#');  do {    fgets(buf, 1000, fp);  /* xsize, ysize */  } while(buf[0] == '#');	if (sscanf(buf, "%d %d", x, y) == 1) {		do {			fgets(buf, 1000, fp);  /* ysize */		} while(buf[0] == '#');		sscanf(buf, "%d", y);	}  do {    fgets(buf, 1000, fp);  /* max value */  } while(buf[0] == '#');    image = (unsigned char *)malloc(*x * *y);  fread(image, *x * *y, 1, fp);  fclose(fp);  return image;}// PGM 画像の出力void writePGM(char *fname, unsigned char *buf, int x, int y) {  FILE *fp;  fp = fopen(fname, "wb");  if(fp == NULL) {    printf("file %s can not be created.\n", fname);    exit(-1);  }  fprintf(fp, "P5\n%d %d\n255\n", x, y);  fwrite(buf, x * y, 1, fp);  fclose(fp);}